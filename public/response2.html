<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
        href="https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Html/styles/fabric.min.css">
    <link rel="stylesheet"
        href="https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Html/styles/Draft.css">
    
    <link rel="stylesheet"
        href="https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Html/styles/react-draft-wysiwyg.css"> 
    <link rel="stylesheet"
        href="https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Html/styles/designer.min.css"> 
    
    <style>
        body {
            background-color: --vscode-editor-background;
            margin: 0;
            padding: 0;
        }
        body.light {
            background-color: #f2f2f2;
        }
        .msla-container {
            margin-top: 52px;
        }
        #app {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 9;
        }
    </style>
    <title>Designer (read-only)</title>
</head>
<body>
    <div id="app"></div>
    <div id="designer" class="msla-container"></div>
    <script src="https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Scripts/logicappdesigner/require.min.js"></script>
    <script>
        (global => {
            "use strict";

            const vscode = acquireVsCodeApi();

            const $locale = "en";

            const baseUrl = "https://ema.hosting.portal.azure.net/ema/Content/1.60315.1.1.210312-1549/Scripts/logicappdesigner/";
           
            global.publicPath = baseUrl;

            function getMonacoLocale(locale) {
                // Mapping of the languages Monaco editor supports. Default to english for non-supported languages.
                const monacoLocalesMap = {
                    "de": "de",
                    "es": "es",
                    "fr": "fr",
                    "it": "it",
                    "ja": "ja",
                    "ko": "ko",
                    "ru": "ru",
                    "zh-hans": "zh-cn",
                    "zh-hant": "zh-tw"
                };

                return monacoLocalesMap[locale] || "en";
            }

            function getResourcePath(locale) {
                if (locale === "en" || !locale) {
                    return "resources.logicapps.min";
                } else {
                    return `loc_gen/${locale}/resources.logicapps.min`;
                }
            }

            const r = requirejs.config({
                baseUrl,
                map: {
                    "*": {
                        "office-ui-fabric-react/lib/common/DirectionalHint": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ActivityItem": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Announced": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Autofill": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Breadcrumb": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Button": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Calendar": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Callout": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Check": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Checkbox": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ChoiceGroup": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Coachmark": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ColorPicker": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ComboBox": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/CommandBar": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ContextualMenu": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/DatePicker": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/DetailsList": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Dialog": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Divider": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/DocumentCard": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Dropdown": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ExtendedPicker": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Fabric": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Facepile": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/FloatingPicker": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/FocusTrapZone": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/FocusZone": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/GroupedList": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/HoverCard": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Icon": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Icons": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Image": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Keytip": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/KeytipData": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/KeytipLayer": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Label": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Layer": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Link": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/List": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/MarqueeSelection": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/MessageBar": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Modal": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Nav": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/OverflowSet": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Overlay": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Panel": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Persona": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/pickers": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Pivot": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Popup": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ProgressIndicator": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Rating": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ResizeGroup": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ScrollablePane": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/SearchBox": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/SelectedItemsList": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Separator": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Shimmer": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Slider": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Spinner": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Stack": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Sticky": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Styling": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/SwatchColorPicker": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/TeachingBubble": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Text": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/TextField": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Theme": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/ThemeGenerator": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Toggle": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Tooltip": "office-ui-fabric-react",
                        "office-ui-fabric-react/lib/Utilities": "office-ui-fabric-react",
                        "reselect": "Reselect"
                    }
                },
                paths: {
                    "@microsoft/load-themed-styles": "@microsoft/load-themed-styles/lib-amd/index",
                    "@uifabric/icons/lib": "@uifabric/icons",
                    "@uifabric/merge-styles/lib": "@uifabric/merge-styles",
                    "@uifabric/styling/lib": "@uifabric/styling",
                    "@uifabric/utilities/lib": "@uifabric/utilities",
                    "core/main": "core.designer.min",
                    "draft-js": "Draft.min",
                    "fuse": "fuse.min",
                    "immutable": "immutable.min",
                    "localforage": "localforage.min",
                    "oauth": "../Workflow/OAuth/OAuthService",
                    "office-ui-fabric-react": "office-ui-fabric-react.min",
                    "prop-types": "prop-types.min",
                    "react": "react.production.min",
                    "react-dom": "react-dom.production.min",
                    "reselect": "reselect",
                    "re-reselect": "re-reselect",
                    "resources": getResourcePath(),
                    "SwaggerParser": "swagger-parser.min",
                    "tslib": "tslib"
                },
                shim: {
                    "office-ui-fabric-react": {
                        "deps": ["prop-types", "react", "react-dom", "tslib"],
                        "exports": "Fabric"
                    }
                },
                waitSeconds: 0
            });

            r(["react", "react-dom"], (React, ReactDOM) => {
                global.React = React;
                global.ReactDOM = ReactDOM;
                r(["core/main", "oauth", "office-ui-fabric-react"], (designercore, OAuth, { CommandBar, Fabric }) => {
                    designercore.requireScriptForEditor(`${baseUrl}/monaco/min/vs`);

                    const monacoLocale = getMonacoLocale($locale);

                    if (monacoLocale !== "en") {
                        global.require.config({
                            "vs/nls": {
                                availableLanguages: {
                                    "*": monacoLocale
                                }
                            }
                        });
                    }

                    const oauthService = new OAuth.OAuthPopupService("https://portal.azure.com", "iframedesigner");

                    const getArmAccessToken = async () => {
                        return "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyIsImtpZCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9jOTUzNjY4NS0xMjYyLTQyMGItYTk0Yi00ZjU0MjAyODQ2ODAvIiwiaWF0IjoxNjc2NjMzOTUzLCJuYmYiOjE2NzY2MzM5NTMsImV4cCI6MTY3NjYzNzg1MywiYWlvIjoiRTJaZ1lIQXZVZU9mdk90RCsxN2hwSlU3cDY1YkFnQT0iLCJhcHBpZCI6Ijk5NWMzNTFhLTRkNjItNDkxNC04MzRkLThjNzJkZDEzODc5NCIsImFwcGlkYWNyIjoiMSIsImlkcCI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0L2M5NTM2Njg1LTEyNjItNDIwYi1hOTRiLTRmNTQyMDI4NDY4MC8iLCJpZHR5cCI6ImFwcCIsIm9pZCI6IjZlNDdmZmExLThjYTAtNDMyOC05ZWFjLTE1ZTE3NmVkZjgyMyIsInJoIjoiMC5BU3dBaFdaVHlXSVNDMEtwUzA5VUlDaEdnRVpJZjNrQXV0ZFB1a1Bhd2ZqMk1CTXNBQUEuIiwic3ViIjoiNmU0N2ZmYTEtOGNhMC00MzI4LTllYWMtMTVlMTc2ZWRmODIzIiwidGlkIjoiYzk1MzY2ODUtMTI2Mi00MjBiLWE5NGItNGY1NDIwMjg0NjgwIiwidXRpIjoiSHpOOUxUdlRWa3lmdW1CWXJFTzRBQSIsInZlciI6IjEuMCIsInhtc190Y2R0IjoxNTQ0ODEzNjYzfQ.pF__aIlkfTiM2z63NtMlRTGsAPuXLvgAm2PzSwS-nMLTNO9LpMmo9Ms6ihru4jhzteuM0QwbCa7tsU-tcqSS8fU0xmq4LeBCHydckd_4VJiDKwutE6QxHmMWiuOlTqJiOOSmmNfYtTzGs83ORziXc2VLmlU7P9XILJ-UDj_HGhT-ghzZ2SfQZtaBBT0r-5opN08iM_DGWgRk79BRTMdFBK_FqSD-DSEEg5fgYHPP2jJiMdxJBAelz7vgZ2RpC0RZz9k1cJ1MZA2ue89gnLu1q4270wbKbIm_-8ttRPwPg-z52oJY3yWPUJcXRnzB8UJg8LX7W35i5BKrgjzpQ04P8Q".substring("Bearer ".length);
                    };

                    let designer;

                    function initialize(options, analyticsContextData) {
                        const config = {
                            apiOperationsPath: `/providers/Microsoft.Web/locations/${options.location}/apiOperations`,
                            connectionsPath: "/providers/Microsoft.Web/connections",
                            connectionProvidersPath: `/providers/Microsoft.Web/locations/${options.location}/managedApis`,
                            gatewaysPath: "/providers/Microsoft.Web/connectionGateways"
                        };

                        const urlService = new designercore.LogicAppsUrlService({
                            baseUrl: options.baseUrl,
                            config,
                            integrationAccountId: options.integrationAccountId,
                            location: options.location,
                            resourceGroup: options.resourceGroup,
                            subscriptionId: options.subscriptionId
                        });

                        const apiManagementServiceFactory = analytics => {
                            return new designercore.LogicAppsApiManagementService({
                                analytics,
                                apiVersion: options.apiManagementApiVersion,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                locale: $locale,
                                subscriptionId: options.subscriptionId
                            });
                        };

                        const hostServiceFactory = () => ({
                            openWindow(url) {
                                vscode.postMessage({
                                    command: "OpenWindow",
                                    url
                                });

                                return Promise.resolve(true);
                            }
                        });

                        const analyticsServiceFactory = version => {
                            const telemetryBaseUrl = options.telemetryBaseUrl || options.baseUrl;
                            const telemetryVersion = options.telemetryVersion || options.emaApiVersion;
                            const settings = {
                                analyticsServiceUri: `${telemetryBaseUrl}/providers/Internal.Telemetry/collect?api-version=${telemetryVersion}`,
                                getAccessToken: getArmAccessToken
                            };

                            const contextData = analyticsContextData || {};
                            contextData.host = window.location.host;
                            contextData.hostVersion = options.extensionVersion;
                            contextData.designerVersion = version;

                            const analyticsService = new designercore.AnalyticsService(settings, contextData);
                            analyticsService.startPublish();

                            return analyticsService;
                        }

                        const iseSupported = !!options.featureFlags && !!options.featureFlags.enableintegrationserviceenvironment;

                        const connectionParameterEditorServiceFactory = analytics => {
                            return new designercore.LogicAppsConnectionParameterEditorService({
                                analytics,
                                apiVersion: "2016-06-01",
                                apiVersionForArm: "2019-05-01",
                                apiVersionForWeb: "2018-03-01-preview",
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                getTenantId() {
                                    return undefined;
                                },
                                locale: $locale,
                                location: options.location,
                                subscriptionId: options.subscriptionId
                            });
                        };

                        const connectionServiceFactory = analytics => {
                            return new designercore.LogicAppsConnectionService({
                                analytics,
                                apiVersion: options.connectionApiVersion,
                                apiVersionForConnection: iseSupported ? options.integrationServiceEnvironmentApiVersion : options.connectionApiVersion,
                                apiVersionForCustomConnector: iseSupported ? options.integrationServiceEnvironmentApiVersion : options.connectionApiVersion,
                                apiVersionForGateways: options.connectionApiVersion,
                                apiVersionForIseManagedConnector: iseSupported ? options.integrationServiceEnvironmentApiVersion : options.connectionApiVersion,
                                apiVersionForSharedManagedConnector: iseSupported ? options.integrationServiceEnvironmentApiVersion : options.connectionApiVersion,
                                baseUrl: options.baseUrl,
                                batchApiVersion: options.batchApiVersion,
                                getAccessToken: getArmAccessToken,
                                integrationServiceEnvironmentId: options.integrationServiceEnvironmentId,
                                isIntegrationServiceEnvironmentSupported: iseSupported,
                                oauthService,
                                locale: $locale,
                                location: options.location,
                                urlService
                            });
                        };

                        const connectionConfigurationServiceFactory = analytics => {
                            return new designercore.LogicAppsConnectionConfigurationService({
                                analytics,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                locale: $locale,
                                serviceConfigs: {
                                    "sql": {
                                        serverTemplate: "{0}.database.windows.net"
                                    }
                                },
                                subscriptionId: options.subscriptionId
                            });
                        };

                        const identityServiceFactory = analytics => {
                            return new designercore.LogicAppsIdentityService({
                                analytics,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                currentTenantId: "undefined",
                                apiVersion: options.armApiVersion
                            });
                        };

                        const builtInTypeServiceFactory = (analytics, schemaVersion) => {
                            const options = {
                                httpManagedServiceIdentitySupported: true,
                                openApiConnection: false,
                                showScopeActions: true,
                                showVariableActions: true
                            };

                            return new designercore.LogicAppsBuiltInTypeService(schemaVersion, options);
                        };

                        const functionServiceFactory = analytics => {
                            return new designercore.LogicAppsFunctionService({
                                analytics,
                                apiVersion: options.azureFunctionApiVersion,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                locale: $locale,
                                urlService
                            });
                        };

                        const operationManifestServiceFactory = () => {
                            return new designercore.LogicAppsOperationManifestService();
                        };

                        const userFeedbackServiceFactory = () => {
                            return {
                                getUserFeedbackConfiguration() {
                                    return {
                                        STATIC_RESULT: {
                                            feedbackLink: "https://aka.ms/staticresultforum",
                                            showRating: true
                                        }
                                    };
                                }
                            }
                        };

                        const workflowServiceFactory = analytics => {
                            return new designercore.LogicAppsWorkflowService({
                                analytics,
                                apiVersion: options.emaApiVersion,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                locale: $locale,
                                urlService
                            });
                        };

                        const promotedConnectorsForActions = iseSupported && options.integrationServiceEnvironmentId
                            ? [
                                "connectionProviders/control",
                                "connectionProviders/http",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/servicebus`,
                                `${options.integrationServiceEnvironmentId}/managedApis/servicebus`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sql`,
                                `${options.integrationServiceEnvironmentId}/managedApis/sql`,
                                "connectionProviders/function",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/office365`,
                                `${options.integrationServiceEnvironmentId}/managedApis/office365`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azureblob`,
                                `${options.integrationServiceEnvironmentId}/managedApis/azureblob`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/cognitiveservicestextanalytics`,
                                `${options.integrationServiceEnvironmentId}/managedApis/cognitiveservicestextanalytics`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/keyvault`,
                                `${options.integrationServiceEnvironmentId}/managedApis/keyvault`,
                                "builtin/as2",
                                "builtin/rosettanet"
                            ]
                            : [
                                "connectionProviders/control",
                                "connectionProviders/http",
                                "builtin/code",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/servicebus`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sql`,
                                "connectionProviders/function",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/office365`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azureblob`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/cognitiveservicestextanalytics`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/keyvault`,
                                "builtin/as2",
                                "builtin/rosettanet"
                            ];

                        const promotedConnectorsForTriggers = iseSupported && options.integrationServiceEnvironmentId
                            ? [
                                "connectionProviders/request",
                                "connectionProviders/schedule",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/servicebus`,
                                `${options.integrationServiceEnvironmentId}/managedApis/servicebus`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/twitter`,
                                `${options.integrationServiceEnvironmentId}/managedApis/twitter`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/office365`,
                                `${options.integrationServiceEnvironmentId}/managedApis/office365`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sharepointonline`,
                                `${options.integrationServiceEnvironmentId}/managedApis/sharepointonline`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/ftp`,
                                `${options.integrationServiceEnvironmentId}/managedApis/ftp`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/dynamicscrmonline`,
                                `${options.integrationServiceEnvironmentId}/managedApis/dynamicscrmonline`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sftp`,
                                `${options.integrationServiceEnvironmentId}/managedApis/sftp`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/salesforce`,
                                `${options.integrationServiceEnvironmentId}/managedApis/salesforce`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/rss`,
                                `${options.integrationServiceEnvironmentId}/managedApis/rss`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/onedrive`,
                                `${options.integrationServiceEnvironmentId}/managedApis/onedrive`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azureeventgrid`,
                                `${options.integrationServiceEnvironmentId}/managedApis/azureeventgrid`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azurequeues`,
                                `${options.integrationServiceEnvironmentId}/managedApis/azurequeues`
                            ]
                            : [
                                "connectionProviders/request",
                                "connectionProviders/schedule",
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/servicebus`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/twitter`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/office365`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sharepointonline`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/ftp`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/dynamicscrmonline`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/sftp`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/salesforce`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/rss`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/onedrive`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azureeventgrid`,
                                `/subscriptions/${options.subscriptionId}/providers/Microsoft.Web/locations/${options.location}/managedApis/azurequeues`
                            ];

                        const featuresToEnable = {
                            ALLOW_EMPTY_DEFINITION: true,
                            AUTO_CASTING_IN_PARAMETER_FIELD_TIP: true,
                            COLLAPSE_ALL_CARDS: true,
                            CONCURRENCY: true,
                            DEBOUNCE_EMIT_CHANGE: true,
                            DISABLE_AUTO_FOCUS_PARAMETERS: true,
                            DISABLE_TOKEN_PICKER_COMPACT_MODE: true,
                            ENABLE_ENVIRONMENT_BADGE: false, // TODO(joechung): Enable when ISE is supported in Visual Studio Code.
                            EXCLUDE_AUTHENTICATION: true,
                            FX_TOKEN: true,
                            FX_TOKEN_FOR_CONDITION: true,
                            HTML_EDITOR: true,
                            NEW_CONDITION_RULES_BUILDER: true,
                            NEW_RECOMMENDATION_CARD_WITH_FOR_YOU: true,
                            NEW_RECOMMENDATION_CARD_WITH_MODULES: true,
                            NEW_SCHEMA_EDITOR: true,
                            RAW_MODE: true,
                            SHOW_CONNECTION_NAME: true,
                            SHOW_PARENT_OBJECT_FOR_OUTPUTS: true,
                            SHOW_TOKENS_FOR_FOREACH: false, // TODO(joechung): Enable when the designer enables this in public cloud production.
                            SHOW_TRIGGER_RECURRENCE: true,
                            STATIC_RESULT: true,
                            SUPPORT_OBFUSCATION: true,
                            SUPPORT_PAN_AND_ZOOM: true,
                            SUPPORT_PEEK: true,
                            SUPPRESS_WORKFLOW_HEADERS_ON_RESPONSE: true,
                            TOKEN_COPY_PASTE: true,
                            TOPOLOGY_RENDER: true,
                            USE_CONNECTION_CONFIGURATION_SERVICE: true,
                            USE_DICTIONARY_EDITOR: true,
                            USE_EDITOR_INPUT: true,
                            USE_NEW_EXPRESSION_PARSER: true,
                            USE_TEXT_EDITOR: true
                        };

                        const recommendationServiceFactory = (analytics, schemaVersion) => {
                            return new designercore.LogicAppsSmartRecommendationService({
                                analytics,
                                apiVersion: options.integrationServiceEnvironmentApiVersion,
                                apiVersionForApiManagement: options.apiManagementApiVersion,
                                apiVersionForApiOperations: options.integrationServiceEnvironmentApiVersion,
                                apiVersionForCustomConnector: options.integrationServiceEnvironmentApiVersion,
                                apiVersionForLogicApps: options.integrationServiceEnvironmentApiVersion,
                                apiVersionForManagedConnector: options.integrationServiceEnvironmentApiVersion,
                                apiVersionForWeb: options.azureFunctionApiVersion,
                                baseUrl: options.baseUrl,
                                getAccessToken: getArmAccessToken,
                                hideCustomConnectors: options.hideCustomConnectors,
                                integrationServiceEnvironmentId: options.integrationServiceEnvironmentId,
                                isIntegrationServiceEnvironmentSupported: iseSupported,
                                locale: $locale,
                                location: options.location,
                                promotedConnectorsForActions,
                                promotedConnectorsForTriggers,
                                promotedOperationsForActions: [
                                    "connectionProviders/request"
                                ],
                                resourceGroup: options.resourceGroup,
                                resourceId: analyticsContextData.resourceData.resourceId,
                                schemaVersion,
                                subscription: options.subscriptionId,
                                smartRecommendationServiceOptions: {
                                    getMruKey: () => `${options.subscriptionId}/undefined`,
                                    recommendOperationGroupsPath: `/subscriptions/${options.subscriptionId}/resourceGroups/${options.resourceGroup}/providers/Microsoft.Logic/locations/${options.location}/workflows/${options.logicAppName}/recommendOperationGroups`
                                }
                            });
                        };

                        const flowConfigurationOptions = {
                            analyticsServiceFactory,
                            apiManagementServiceFactory,
                            apiVersion: options.emaApiVersion,
                            azureFunctionsApiVersion: options.azureFunctionApiVersion,
                            baseUrl: options.baseUrl,
                            batchApiVersion: options.batchApiVersion,
                            builtInTypeServiceFactory,
                            connectionConfigurationServiceFactory: connectionConfigurationServiceFactory,
                            connectionGatewayApiVersion: options.connectionGatewayApiVersion,
                            connectionParameterEditorServiceFactory,
                            connectionServiceFactory,
                            dynamicCallApiVersion: options.connectionApiVersion, // Service in the designer side uses connections api to make proxy call for dynamic content.
                            features: featuresToEnable,
                            functionServiceFactory,
                            getArmAccessToken,
                            getRuntimeAccessToken: getArmAccessToken,
                            host: window.location.host,
                            hostEnvironment: designercore.Host.LogicApps,
                            hostServiceFactory,
                            hostVersion: options.extensionVersion,
                            identityServiceFactory,
                            locale: $locale,
                            oauthService,
                            operationManifestServiceFactory,
                            prefetchedData: {
                                connectionProviders: !!options.connectionProviders ? JSON.parse(options.connectionProviders) : undefined
                            },
                            recommendationServiceFactory,
                            startTelemetryPublish: false,
                            telemetryBaseUrl: options.telemetryBaseUrl,
                            telemetryVersion: options.telemetryVersion,
                            urlService,
                            userFeedbackServiceFactory,
                            workflowServiceFactory
                        };

                        disposeDesigner();

                        designer = window.designer = new designercore.Designer(flowConfigurationOptions, document.getElementById("designer"));
                    }

                    function loadDefinition(logicApp, callbacks, options) {
                        const { connectionReferences, definition, parameters, sku } = logicApp;
                        const loadOptions = { ...options };
                        const workflow = {
                            connectionReferences,
                            definition,
                            parameters,
                            properties: {
                                callbacks,
                                sku
                            }
                        };

                        return designer.loadWorkflow(workflow, loadOptions);
                    }

                    function disposeDesigner() {
                        if (designer) {
                            designer.dispose();
                            designer = null;
                        }
                    }

                    (async () => {
                        function changeTheme() {
                            const { classList } = document.body;
                            const isInverted = classList.contains("vscode-dark");
                            const theme = isInverted ? "dark" : "light";
                            if (!classList.contains(theme)) {
                                classList.remove("dark", "light");
                                classList.add(theme);
                                designer.changeTheme(theme);
                            }
                        }

                        const options = {
                            apiManagementApiVersion: "2015-09-15",
                            armApiVersion: "2017-08-01",
                            azureFunctionApiVersion: "2015-08-01",
                            baseUrl: "https://management.azure.com",
                            batchApiVersion: "2015-11-01",
                            connectionApiVersion: "2016-06-01",
                            connectionGatewayApiVersion: "2016-06-01",
                            emaApiVersion: "2016-10-01",
                            enableMock: false,
                            extensionVersion: "1.60315.1.1.210312-1549",
                            featureFlags: {
                                enableintegrationserviceenvironment: false,
                                htmleditor: false,
                                showforeachtokens: false
                            },
                            hideCustomConnectors: false,
                            integrationAccountId: undefined,
                            integrationServiceEnvironmentApiVersion: "2018-07-01-preview",
                            location: "eastus2",
                            resourceGroup: "rg-by-workflow-shared-dev-eus2-01",
                            subscriptionId: "ad1e9f34-2525-4721-8777-445d89a891c7",
                            telemetryBaseUrl: "https://management.azure.com",
                            telemetryVersion: "2015-09-30-preview"
                        };

                        const analyticsContextData = {
                            resourceData: {
                                resourceId: "63ef5e19bff145418c1194b7",
                                source: "vscodeDesigner"
                            }
                        };

                        const logicApp = {
                            connectionReferences: {},
                            definition: {"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"2021.1.0.2","parameters":{"$byparams":{"defaultValue":{},"type":"Object"}},"triggers":{"request":{"type":"Request","kind":"Http","inputs":{"schema":{}}}},"actions":{},"outputs":{}},
                            parameters: {"$byparams":{"value":{"applicationId":"","location":"","office365ConnectionName":"","resourceGroup":"","realmContext":"","subscriptionId":""}}},
                            sku: {"name":"Consumption"}
                        };

                        const callbacks = {} 
                        await initialize(options, analyticsContextData);
                        await loadDefinition(logicApp, callbacks, {"initReadonly":true});

                        function App({ readOnly }) {
                            async function handleSave() {
                                try {
                                    const { definition, parameters } = await designer.getWorkflow({ skipValidation: false });
                                    vscode.postMessage({
                                        command: "Save",
                                        definition: JSON.stringify(definition),
                                        parameters
                                    });
                                } catch (error) {
                                    vscode.postMessage({
                                        command: "ShowError",
                                        errorMessage: error.message
                                    });
                                }
                            }

                            if (readOnly) {
                                return null;
                            }

                            const items = [
                                {
                                    key: "Save",
                                    ariaLabel: "Save",
                                    iconProps: {
                                        iconName: "Save"
                                    },
                                    name: "Save",
                                    onClick: handleSave
                                }
                            ];

                            return (
                                React.createElement(Fabric, null,
                                    React.createElement(CommandBar, { items })
                                )
                            );
                        }

                        designer.render();
                        changeTheme();

                        const callback = mutations => {
                            if (mutations.length > 0) {
                                const mutation = mutations[0];
                                if (mutation.target instanceof Element) {
                                    changeTheme();
                                }
                            }
                        };
                        const observer = new MutationObserver(callback);
                        observer.observe(document.body, { attributeFilter: ["class"], attributes: true });

                        ReactDOM.render(React.createElement(App, { readOnly: true }), document.getElementById("app"));
                    })();
                });
            });
        })(window);
    </script>
</body>
</html>
